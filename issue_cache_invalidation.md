# 캐시 무효화 시스템 개선

## 문제점

현재 캐시 시스템에 다음과 같은 문제가 있었습니다:

1. **Vercel KV 패턴 삭제 미지원**
   - `deleteCachePattern('articles:*')`가 실제로 작동하지 않음
   - Vercel KV는 패턴 기반 삭제를 지원하지 않아 캐시 무효화가 실패

2. **새 글이 즉시 반영되지 않음**
   - 글 작성/수정/삭제 시에도 캐시가 무효화되지 않아
   - TTL(30분~1시간)이 지나기 전까지 새 글이 목록에 표시되지 않음
   - 프로덕션 환경에서 사용자 경험 저하

3. **개발 환경에서도 캐시 사용**
   - 개발 중 최신 데이터 확인이 어려움
   - 디버깅이 어려워짐

## 해결 방법

### 1. 캐시 버전 관리 시스템 도입

- 캐시 키에 버전 번호를 추가하여 자동 무효화
- 글 작성/수정/삭제 시 버전 번호만 증가시키면 모든 캐시가 자동으로 무효화됨
- Vercel KV에서도 완벽하게 작동

**캐시 키 형식 변경:**
- 기존: `articles:all:recent:10:0:guest`
- 변경: `articles:all:recent:10:0:guest:v2` (버전 번호 추가)

### 2. 개발 환경 캐시 비활성화

- 개발 환경에서는 캐시를 사용하지 않아 항상 최신 데이터 확인 가능
- 프로덕션 환경에서만 캐시 사용으로 성능 최적화 유지

## 구현 내용

### 새로 생성된 파일

- `lib/cache-version.ts`: 캐시 버전 관리 시스템
  - `getCacheVersion()`: 현재 캐시 버전 조회
  - `incrementCacheVersion()`: 캐시 버전 증가 (글 작성/수정/삭제 시 호출)

- `lib/cache-invalidation.ts`: 캐시 무효화 헬퍼 (대안 방법, 현재는 사용하지 않음)

### 수정된 파일

- `lib/cache.ts`
  - `createVersionedCacheKey()`: 버전이 포함된 캐시 키 생성 함수 추가

- `app/api/articles/route.ts`
  - 캐시 키 생성 시 버전 번호 포함
  - 개발 환경에서 캐시 비활성화
  - 글 작성 시 `incrementCacheVersion()` 호출

- `app/api/articles/featured/route.ts`
  - 캐시 키 생성 시 버전 번호 포함
  - 개발 환경에서 캐시 비활성화

- `app/api/articles/[id]/route.ts`
  - 글 수정/삭제 시 `incrementCacheVersion()` 호출

## 테스트

- [x] 개발 환경에서 캐시 비활성화 확인
- [x] 새 글 작성 시 즉시 목록에 표시되는지 확인
- [x] 글 수정 시 즉시 반영되는지 확인
- [x] 글 삭제 시 즉시 목록에서 제거되는지 확인

## 예상 효과

1. **즉시 반영**: 새 글이 작성되면 바로 목록에 표시됨
2. **Vercel KV 호환**: 패턴 삭제가 필요 없어 Vercel KV에서도 완벽 작동
3. **개발 편의성**: 개발 환경에서 항상 최신 데이터 확인 가능
4. **성능 유지**: 프로덕션 환경에서 캐시로 성능 최적화 유지

