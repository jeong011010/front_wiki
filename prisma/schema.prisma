generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  password  String
  name      String
  role      String    @default("user")
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  articles  Article[]

  @@index([email])
}

model Category {
  id          String     @id @default(cuid())
  name        String
  slug        String     @unique
  description String?
  parentId    String?
  order       Int        @default(0)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  articles    Article[]
  parent      Category?  @relation("CategoryTree", fields: [parentId], references: [id], onDelete: Cascade)
  children    Category[] @relation("CategoryTree")

  @@index([slug])
  @@index([parentId])
}

model Article {
  id            String        @id @default(cuid())
  title         String        @unique
  slug          String        @unique
  content       String
  status        String        @default("published")
  categoryId    String?
  authorId      String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  category      Category?     @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  author        User?         @relation(fields: [authorId], references: [id], onDelete: SetNull)
  incomingLinks ArticleLink[] @relation("ToArticle")
  outgoingLinks ArticleLink[] @relation("FromArticle")

  @@index([slug])
  @@index([title])
  @@index([status])
  @@index([authorId])
  @@index([categoryId])
}

model ArticleLink {
  id            String   @id @default(cuid())
  keyword       String
  fromArticleId String
  toArticleId   String
  relationType  String   @default("auto")
  createdAt     DateTime @default(now())
  toArticle     Article  @relation("ToArticle", fields: [toArticleId], references: [id], onDelete: Cascade)
  fromArticle   Article  @relation("FromArticle", fields: [fromArticleId], references: [id], onDelete: Cascade)

  @@unique([fromArticleId, toArticleId, keyword])
  @@index([fromArticleId])
  @@index([toArticleId])
  @@index([keyword])
  @@index([relationType])
}
